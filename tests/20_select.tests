# Iteration 20: Select

# === Basic select ===

=== simple select
select x in a b c; do echo $x; done
---
(select "x" (words "a" "b" "c") (command (word "echo") (word "$x" (param "x"))))

=== select without in uses positional params
select x do echo $x; done
---
(select "x" (command (word "echo") (word "$x" (param "x"))))

=== select with semicolon after name
select x; do echo $x; done
---
(select "x" (command (word "echo") (word "$x" (param "x"))))

=== select with empty word list
select x in ; do echo $x; done
---
(select "x" (words) (command (word "echo") (word "$x" (param "x"))))

# === Select with brace group ===

=== select with brace group body
select x in a b c; { echo $x; }
---
(select "x" (words "a" "b" "c") (brace-group (list (command (word "echo") (word "$x" (param "x"))) (semi))))

# === Select with various word types ===

=== select with quoted words
select f in "file one" "file two"; do cat "$f"; done
---
(select "f" (words "\"file one\"" "\"file two\"") (command (word "cat") (word "\"$f\"" (param "f"))))

=== select with variable expansion
select x in $options; do echo $x; done
---
(select "x" (words "$options") (command (word "echo") (word "$x" (param "x"))))

=== select with glob
select f in *.txt; do cat $f; done
---
(select "f" (words "*.txt") (command (word "cat") (word "$f" (param "f"))))

=== select with array expansion
select x in ${arr[@]}; do echo $x; done
---
(select "x" (words "${arr[@]}") (command (word "echo") (word "$x" (param "x"))))

# === Select with complex body ===

=== select with multiple commands
select x in a b; do echo $x; break; done
---
(select "x" (words "a" "b") (list (command (word "echo") (word "$x" (param "x"))) (semi) (command (word "break"))))

=== select with if in body
select x in a b c; do if [ "$x" = "b" ]; then break; fi; done
---
(select "x" (words "a" "b" "c") (if (command (word "[") (word "\"$x\"" (param "x")) (word "=") (word "\"b\"") (word "]")) (command (word "break"))))

=== select with case in body
select opt in quit help; do case $opt in quit) break;; esac; done
---
(select "opt" (words "quit" "help") (case (word "$opt" (param "opt")) (pattern "quit" (command (word "break")))))

# === Select in context ===

=== select in list
select x in a b; do echo $x; done; echo done
---
(list (select "x" (words "a" "b") (command (word "echo") (word "$x" (param "x")))) (semi) (command (word "echo") (word "done")))

=== select with redirect
select x in a b; do echo $x; done > output.txt
---
(select "x" (words "a" "b") (command (word "echo") (word "$x" (param "x"))) (redirect ">" (word "output.txt")))

# === Brutal edge cases from research ===

=== nested select
select x in a b; do select y in 1 2; do echo $x $y; done; done
---
(select "x" (words "a" "b") (select "y" (words "1" "2") (command (word "echo") (word "$x" (param "x")) (word "$y" (param "y")))))

=== select with break 2
select x in a; do select y in 1; do break 2; done; done
---
(select "x" (words "a") (select "y" (words "1") (command (word "break") (word "2"))))

=== select with REPLY variable
select x in a b; do echo $REPLY; done
---
(select "x" (words "a" "b") (command (word "echo") (word "$REPLY" (param "REPLY"))))

=== select with command substitution words
select x in $(echo a b c); do echo $x; done
---
(select "x" (words "$(echo a b c)") (command (word "echo") (word "$x" (param "x"))))

=== select with arithmetic in words
select x in $((1+1)) $((2+2)); do echo $x; done
---
(select "x" (words "$((1+1))" "$((2+2))") (command (word "echo") (word "$x" (param "x"))))

=== select single word
select x in choice; do echo $x; done
---
(select "x" (words "choice") (command (word "echo") (word "$x" (param "x"))))

=== select with continue
select x in a b; do if [ -z "$x" ]; then continue; fi; echo $x; done
---
(select "x" (words "a" "b") (list (if (command (word "[") (word "-z") (word "\"$x\"" (param "x")) (word "]")) (command (word "continue"))) (semi) (command (word "echo") (word "$x" (param "x")))))

=== select in function
f() { select x in a b; do echo $x; done; }
---
(function "f" (brace-group (list (select "x" (words "a" "b") (command (word "echo") (word "$x" (param "x")))) (semi))))

=== select with here string redirect
select x in a b; do cat; done <<< input
---
(select "x" (words "a" "b") (command (word "cat")) (redirect "<<<" (word "input")))

=== time select
time select x in a; do break; done
---
(time (select "x" (words "a") (command (word "break"))))

=== negated select
! select x in a; do break; done
---
(negation (select "x" (words "a") (command (word "break"))))


